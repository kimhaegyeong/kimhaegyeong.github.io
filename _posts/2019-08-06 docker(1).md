---
title: SQL 실무 과정 - 첫수업
tags : [Dokcer]
---

# 2019.08.05


## 환경 설정

### SSH 로그인
```sh
  05/08/2019   20:18.06   /home/mobaxterm  ssh root@192.168.207.38 -p15022
Warning: Permanently added '[192.168.207.38]:15022' (RSA) to the list of known hosts.
root@192.168.207.38's password:
X11 forwarding request failed on channel 0
Last login: Mon Aug  5 07:26:54 2019
[root@localhost ~]# hostname
localhost.localdomain
```

### 패키지 설치
```sh
# net-tools
# epel-relase
# wget
[root@localhost ~]# yum install net-tootls -y
[root@localhost ~]# ifconfig
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::b921:c3b7:9af2:80c4  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:43:15:a9  txqueuelen 1000  (Ethernet)
        RX packets 19197  bytes 24063122 (22.9 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3306  bytes 221724 (216.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


[root@localhost ~]# yum install epel-release -y
[root@localhost ~]# yum install wget -y
```


### VM 복제
* 복제전 SELinux policy 변경, 방화벽 비활성화
```sh
[root@localhost ~]# vi /etc/sysconfig/selinux
[root@localhost ~]# cat /etc/sysconfig/selinux

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled     # SELinux policy 변경
# SELINUXTYPE= can take one of three values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected.
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted


# 방화벽 비활성화
[root@localhost ~]# systemctl disable firewalld
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.

# 방화벽 비활성화 후 정지
[root@localhost ~]# systemctl stop firewalld

# 리눅스 종료
[root@localhost ~]# shutdown -P now
```

* virtualBox 복제
    * 복제방식 : 완전한 복제
    * 스냅샷 : 모두
    * MAC 주소 정책 : 모든 네트워크 어댑터의 새 MAC 주소 생성


* 호스트 설정
```sh
# 호스트네임 변경
vi /etc/hostname

# 호스트 등록
vi /etc/hosts
10.0.2.5 vm1
10.0.2.15 vm2
10.0.2.4 vm3


# 호스트 파일 scp
# 기준 -> vm2 로
scp /etc/hosts vm2:/etc/hosts

# docker 설치
curl -sSL http://get.docker.com | sh
systemctl start docker
systemctl enable docker

docker -version
docker info

docker pull ubuntu
docker run -it ubuntu
```


---------------------------------------------------------------------------------------------

## Docker란?
* Container
    - 커널을 공유
* VM
    - 커널이 각자 다름

※ 윈도우즈에서 만든 도커 이미지는 윈도우즈에서만
  리눅스에서 만든 도커 이미지는 리눅스에서만...
  Win 10 부터 (윈도우 커널 + 우툰투 커널)이 있어 리눅스에서 만든 도커 이미지도 사용 가능






# 2019.08.06


# 커널 정보
```sh
[root@vm2 ~]# uname -r
3.10.0-957.el7.x86_64
```

```sh
[root@vm1 ~]# docker pull ubuntu
Using default tag: latest
latest: Pulling from library/ubuntu
Digest: sha256:c303f19cfe9ee92badbbbd7567bc1ca47789f79303ddcef56f77687d4744cd7a
Status: Image is up to date for ubuntu:latest
docker.io/library/ubuntu:latest
[root@vm1 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
[root@vm1 ~]# clear
[root@vm1 ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              3556258649b2        13 days ago         64.2MB
[root@vm1 ~]# docker run -it alpine /bin/sh
Unable to find image 'alpine:latest' locally
latest: Pulling from library/alpine
050382585609: Pull complete
Digest: sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998
Status: Downloaded newer image for alpine:latest
/ #
/ # uname -r
3.10.0-957.el7.x86_64
/ #



[root@vm1 ~]# docker rm $(docker ps -aq) -f
4fdd7c0e1f2e



[root@vm1 ~]# docker run -d -p 80:80 nginx
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
f5d23c7fed46: Pulling fs layer
918b255d86e5: Pulling fs layer
8c0120a6f561: Pulling fs layer

[root@vm1 ~]# docker run -d -p 8080:8080 pengbai/docker-supermario
```


```sh
# docker 디렉토리 용량 확인
[root@vm3 ~]# du -sh /var/lib/docker
779M    /var/lib/docker

# centos 이미지 다운로드
[root@vm3 ~]# docker pull centos
Using default tag: latest
latest: Pulling from library/centos
8ba884070f61: Pull complete
Digest: sha256:a799dd8a2ded4a83484bbae769d97655392b3f86533ceb7dd96bbac929809f3c
Status: Downloaded newer image for centos:latest
docker.io/library/centos:latest

# 이미지 조회
[root@vm3 ~]# docker images
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
ubuntu                      latest              3556258649b2        13 days ago         64.2MB
alpine                      latest              b7b28af77ffe        3 weeks ago         5.58MB
centos                      latest              9f38484d220f        4 months ago        202MB
pengbai/docker-supermario   latest              49beaba1c5cc        13 months ago       686MB

# 실행
[root@vm3 ~]# docker run -it centos

[root@4c30bc844e2a /]# exit
exit
[root@vm3 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
[root@vm3 ~]# docker ps -a
CONTAINER ID        IMAGE                       COMMAND             CREATED              STATUS                        PORTS               NAMES
4c30bc844e2a        centos                      "/bin/bash"         About a minute ago   Exited (0) 7 seconds ago                          stupefied_hoover
07e7ccff4a65        pengbai/docker-supermario   "catalina.sh run"   35 minutes ago       Exited (143) 33 minutes ago                       romantic_nash
4ff207e0bed0        pengbai/docker-supermario   "catalina.sh run"   49 minutes ago       Exited (143) 45 minutes ago                       friendly_mendeleev
[root@vm3 ~]# docker start dbc

docker exec -it ....



# 도커 프로세스 조회
[root@vm3 ~]# docker ps -a -q
a500d511acb0
65505326b06f
55a93d9d5792
4c30bc844e2a
07e7ccff4a65
4ff207e0bed0
[root@vm3 ~]# docker ps -aq
a500d511acb0
65505326b06f
55a93d9d5792
4c30bc844e2a
07e7ccff4a65
4ff207e0bed0

# 실행중인 모든 도커 프로세스 강제종료
[root@vm3 ~]# docker rm $(docker ps -aq) -f
a500d511acb0
65505326b06f
55a93d9d5792
4c30bc844e2a
07e7ccff4a65
4ff207e0bed0
[root@vm3 ~]# docker ps -aq
```

* docker system prune : 쓸모없는 것만 정리
* docker rm : 삭제

□ remove 유사 단어
    - delete
    - truncate
    - flush : 누적된 것을 삭제
    - purge : 일소하다. 모두 삭제


## docker --help

### help 매뉴얼
```sh

[root@vm1 ~]# docker --help
[root@vm1 ~]# docker -h

Usage:  docker [OPTIONS] COMMAND

A self-sufficient runtime for containers

Options:
      --config string      Location of client config files (default "/root/.docker")
  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and default context
                           set with "docker context use")
  -D, --debug              Enable debug mode
  -H, --host list          Daemon socket(s) to connect to
  -l, --log-level string   Set the logging level ("debug"|"info"|"warn"|"error"|"fatal") (default "info")
      --tls                Use TLS; implied by --tlsverify
      --tlscacert string   Trust certs signed only by this CA (default "/root/.docker/ca.pem")
      --tlscert string     Path to TLS certificate file (default "/root/.docker/cert.pem")
      --tlskey string      Path to TLS key file (default "/root/.docker/key.pem")
      --tlsverify          Use TLS and verify the remote
  -v, --version            Print version information and quit

Management Commands:
  builder     Manage builds
  config      Manage Docker configs
  container   Manage containers
  context     Manage contexts
  engine      Manage the docker engine
  image       Manage images
  network     Manage networks
  node        Manage Swarm nodes
  plugin      Manage plugins
  secret      Manage Docker secrets
  service     Manage services
  stack       Manage Docker stacks
  swarm       Manage Swarm
  system      Manage Docker
  trust       Manage trust on Docker images
  volume      Manage volumes

Commands:
  attach      Attach local standard input, output, and error streams to a running container
  build       Build an image from a Dockerfile
  commit      Create a new image from a container's changes
  cp          Copy files/folders between a container and the local filesystem
  create      Create a new container
  diff        Inspect changes to files or directories on a container's filesystem
  events      Get real time events from the server
  exec        Run a command in a running container
  export      Export a container's filesystem as a tar archive
  history     Show the history of an image
  images      List images
  import      Import the contents from a tarball to create a filesystem image
  info        Display system-wide information
  inspect     Return low-level information on Docker objects
  kill        Kill one or more running containers
  load        Load an image from a tar archive or STDIN
  login       Log in to a Docker registry
  logout      Log out from a Docker registry
  logs        Fetch the logs of a container
  pause       Pause all processes within one or more containers
  port        List port mappings or a specific mapping for the container
  ps          List containers
  pull        Pull an image or a repository from a registry
  push        Push an image or a repository to a registry
  rename      Rename a container
  restart     Restart one or more containers
  rm          Remove one or more containers
  rmi         Remove one or more images
  run         Run a command in a new container
  save        Save one or more images to a tar archive (streamed to STDOUT by default)
  search      Search the Docker Hub for images
  start       Start one or more stopped containers
  stats       Display a live stream of container(s) resource usage statistics
  stop        Stop one or more running containers
  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
  top         Display the running processes of a container
  unpause     Unpause all processes within one or more containers
  update      Update configuration of one or more containers
  version     Show the Docker version information
  wait        Block until one or more containers stop, then print their exit codes

Run 'docker COMMAND --help' for more information on a command.
```



### docker image

```sh
[root@vm1 ~]# docker image pull --help

Usage:  docker image pull [OPTIONS] NAME[:TAG|@DIGEST]

Pull an image or a repository from a registry

Options:
  -a, --all-tags                Download all tagged images in the repository
      --disable-content-trust   Skip image verification (default true)
  -q, --quiet                   Suppress verbose output
[root@vm1 ~]# docker image pull busybox
Using default tag: latest
latest: Pulling from library/busybox
ee153a04d683: Pull complete
Digest: sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70
Status: Downloaded newer image for busybox:latest
docker.io/library/busybox:latest
[root@vm1 ~]# docker image ls
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
ubuntu                      latest              3556258649b2        13 days ago         64.2MB
busybox                     latest              db8ee88ad75f        2 weeks ago         1.22MB
alpine                      latest              b7b28af77ffe        3 weeks ago         5.58MB
pengbai/docker-supermario   latest              49beaba1c5cc        13 months ago       686MB
[root@vm1 ~]# docker image prune --help

Usage:  docker image prune [OPTIONS]

Remove unused images

Options:
  -a, --all             Remove all unused images, not just dangling ones
      --filter filter   Provide filter values (e.g. 'until=<timestamp>')
  -f, --force           Do not prompt for confirmation

# 컨테이너를 한번도 실행하지 않는 경우 삭제됨
[root@vm1 ~]# docker image prune -a
WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to continue? [y/N] y
Deleted Images:
untagged: alpine:latest
untagged: alpine@sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998
deleted: sha256:b7b28af77ffec6054d13378df4fdf02725830086c7444d9c278af25312aa39b9
deleted: sha256:1bfeebd65323b8ddf5bd6a51cc7097b72788bc982e9ab3280d53d3c613adffa7
untagged: busybox:latest
untagged: busybox@sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70
deleted: sha256:db8ee88ad75f6bdc74663f4992a185e2722fa29573abcc1a19186cc5ec09dceb
deleted: sha256:0d315111b4847e8cd50514ca19657d1e8d827f4e128d172ce8b2f76a04f3faea
untagged: ubuntu:latest
untagged: ubuntu@sha256:c303f19cfe9ee92badbbbd7567bc1ca47789f79303ddcef56f77687d4744cd7a
deleted: sha256:3556258649b2ef23a41812be17377d32f568ed9f45150a26466d2ea26d926c32
deleted: sha256:e68a9307017f6b268915b4d1b537ff663ff6967a37c85bd03a26f2e171ee9f6f
deleted: sha256:ed8308579f11f616d6b58e6e456f765f8e3837f69f81f7304f213c4e3aa96856
deleted: sha256:a757708db54bb9fe5cc7962e8890e008992209d6eca7d6556db03d2891159fef
deleted: sha256:543791078bdb84740cb5457abbea10d96dac3dea8c07d6dc173f734c20c144fe

Total reclaimed space: 70.99MB


[root@vm1 ~]# docker image ls
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
pengbai/docker-supermario   latest              49beaba1c5cc        13 months ago       686MB
[root@vm1 ~]# docker image rm pengbai/docker-supermario
# 사용중인 컨테이너 삭제시 발생 오류
Error response from daemon: conflict: unable to remove repository reference "pengbai/docker-supermario" (must force) - container 07e7ccff4a65 is using its referenced image 49beaba1c5cc

# 도커이미지 강제 삭제
[root@vm1 ~]# docker image rm pengbai/docker-supermario -f
Untagged: pengbai/docker-supermario:latest
Untagged: pengbai/docker-supermario@sha256:eb29639f45339bbd1108a0e329131730c524e18dd1763bcc64b09c6fde59ab94
Deleted: sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62
[root@vm1 ~]#
```


```sh

[root@vm1 ~]# docker pull alpine
Using default tag: latest
latest: Pulling from library/alpine
050382585609: Pull complete
Digest: sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998
Status: Downloaded newer image for alpine:latest
docker.io/library/alpine:latest
[root@vm1 ~]# docker image pull busybox
Using default tag: latest
latest: Pulling from library/busybox
ee153a04d683: Pull complete
Digest: sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70
Status: Downloaded newer image for busybox:latest
docker.io/library/busybox:latest
[root@vm1 ~]# docker container --help

Usage:  docker container COMMAND

Manage containers

Commands:
  attach      Attach local standard input, output, and error streams to a running container
  commit      Create a new image from a container's changes
  cp          Copy files/folders between a container and the local filesystem
  create      Create a new container
  diff        Inspect changes to files or directories on a container's filesystem
  exec        Run a command in a running container
  export      Export a container's filesystem as a tar archive
  inspect     Display detailed information on one or more containers
  kill        Kill one or more running containers
  logs        Fetch the logs of a container
  ls          List containers
  pause       Pause all processes within one or more containers
  port        List port mappings or a specific mapping for the container
  prune       Remove all stopped containers
  rename      Rename a container
  restart     Restart one or more containers
  rm          Remove one or more containers
  run         Run a command in a new container
  start       Start one or more stopped containers
  stats       Display a live stream of container(s) resource usage statistics
  stop        Stop one or more running containers
  top         Display the running processes of a container
  unpause     Unpause all processes within one or more containers
  update      Update configuration of one or more containers
  wait        Block until one or more containers stop, then print their exit codes

Run 'docker container COMMAND --help' for more information on a command.
[root@vm1 ~]# docker container run --help

Usage:  docker container run [OPTIONS] IMAGE [COMMAND] [ARG...]

Run a command in a new container

Options:
      --add-host list                  Add a custom host-to-IP mapping (host:ip)
  -a, --attach list                    Attach to STDIN, STDOUT or STDERR
      --blkio-weight uint16            Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)
      --blkio-weight-device list       Block IO weight (relative device weight) (default [])
      --cap-add list                   Add Linux capabilities
      --cap-drop list                  Drop Linux capabilities
      --cgroup-parent string           Optional parent cgroup for the container
      --cidfile string                 Write the container ID to the file
      --cpu-period int                 Limit CPU CFS (Completely Fair Scheduler) period
      --cpu-quota int                  Limit CPU CFS (Completely Fair Scheduler) quota
      --cpu-rt-period int              Limit CPU real-time period in microseconds
      --cpu-rt-runtime int             Limit CPU real-time runtime in microseconds
  -c, --cpu-shares int                 CPU shares (relative weight)
      --cpus decimal                   Number of CPUs
      --cpuset-cpus string             CPUs in which to allow execution (0-3, 0,1)
      --cpuset-mems string             MEMs in which to allow execution (0-3, 0,1)
  -d, --detach                         Run container in background and print container ID
      --detach-keys string             Override the key sequence for detaching a container
      --device list                    Add a host device to the container
      --device-cgroup-rule list        Add a rule to the cgroup allowed devices list
      --device-read-bps list           Limit read rate (bytes per second) from a device (default [])
      --device-read-iops list          Limit read rate (IO per second) from a device (default [])
      --device-write-bps list          Limit write rate (bytes per second) to a device (default [])
      --device-write-iops list         Limit write rate (IO per second) to a device (default [])
      --disable-content-trust          Skip image verification (default true)
      --dns list                       Set custom DNS servers
      --dns-option list                Set DNS options
      --dns-search list                Set custom DNS search domains
      --domainname string              Container NIS domain name
      --entrypoint string              Overwrite the default ENTRYPOINT of the image
  -e, --env list                       Set environment variables
      --env-file list                  Read in a file of environment variables
      --expose list                    Expose a port or a range of ports
      --gpus gpu-request               GPU devices to add to the container ('all' to pass all GPUs)
      --group-add list                 Add additional groups to join
      --health-cmd string              Command to run to check health
      --health-interval duration       Time between running the check (ms|s|m|h) (default 0s)
      --health-retries int             Consecutive failures needed to report unhealthy
      --health-start-period duration   Start period for the container to initialize before starting health-retries countdown
                                       (ms|s|m|h) (default 0s)
      --health-timeout duration        Maximum time to allow one check to run (ms|s|m|h) (default 0s)
      --help                           Print usage
  -h, --hostname string                Container host name
      --init                           Run an init inside the container that forwards signals and reaps processes
  -i, --interactive                    Keep STDIN open even if not attached
      --ip string                      IPv4 address (e.g., 172.30.100.104)
      --ip6 string                     IPv6 address (e.g., 2001:db8::33)
      --ipc string                     IPC mode to use
      --isolation string               Container isolation technology
      --kernel-memory bytes            Kernel memory limit
  -l, --label list                     Set meta data on a container
      --label-file list                Read in a line delimited file of labels
      --link list                      Add link to another container
      --link-local-ip list             Container IPv4/IPv6 link-local addresses
      --log-driver string              Logging driver for the container
      --log-opt list                   Log driver options
      --mac-address string             Container MAC address (e.g., 92:d0:c6:0a:29:33)
  -m, --memory bytes                   Memory limit
      --memory-reservation bytes       Memory soft limit
      --memory-swap bytes              Swap limit equal to memory plus swap: '-1' to enable unlimited swap
      --memory-swappiness int          Tune container memory swappiness (0 to 100) (default -1)
      --mount mount                    Attach a filesystem mount to the container
      --name string                    Assign a name to the container
      --network network                Connect a container to a network
      --network-alias list             Add network-scoped alias for the container
      --no-healthcheck                 Disable any container-specified HEALTHCHECK
      --oom-kill-disable               Disable OOM Killer
      --oom-score-adj int              Tune host's OOM preferences (-1000 to 1000)
      --pid string                     PID namespace to use
      --pids-limit int                 Tune container pids limit (set -1 for unlimited)
      --privileged                     Give extended privileges to this container
  -p, --publish list                   Publish a container's port(s) to the host
  -P, --publish-all                    Publish all exposed ports to random ports
      --read-only                      Mount the container's root filesystem as read only
      --restart string                 Restart policy to apply when a container exits (default "no")
      --rm                             Automatically remove the container when it exits
      --runtime string                 Runtime to use for this container
      --security-opt list              Security Options
      --shm-size bytes                 Size of /dev/shm
      --sig-proxy                      Proxy received signals to the process (default true)
      --stop-signal string             Signal to stop a container (default "SIGTERM")
      --stop-timeout int               Timeout (in seconds) to stop a container
      --storage-opt list               Storage driver options for the container
      --sysctl map                     Sysctl options (default map[])
      --tmpfs list                     Mount a tmpfs directory
  -t, --tty                            Allocate a pseudo-TTY
      --ulimit ulimit                  Ulimit options (default [])
  -u, --user string                    Username or UID (format: <name|uid>[:<group|gid>])
      --userns string                  User namespace to use
      --uts string                     UTS namespace to use
  -v, --volume list                    Bind mount a volume
      --volume-driver string           Optional volume driver for the container
      --volumes-from list              Mount volumes from the specified container(s)
  -w, --workdir string                 Working directory inside the container



[root@vm1 ~]# docker container run -it alpine
/ # exit
[root@vm1 ~]# docker run -it alpine
/ # exit
[root@vm1 ~]# docker run -it alpine
/ # ^C
/ # exit


# docker container ps -a
[root@vm1 ~]# docker container ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                           PORTS               NAMES
83c7ba0b22f3        alpine              "/bin/sh"           37 seconds ago      Exited (130) 7 seconds ago                           blissful_solomon
73f0505a2385        alpine              "/bin/sh"           50 seconds ago      Exited (0) 42 seconds ago                            objective_lamport
07e7ccff4a65        49beaba1c5cc        "catalina.sh run"   57 minutes ago      Exited (143) 55 minutes ago                          romantic_nash
4ff207e0bed0        49beaba1c5cc        "catalina.sh run"   About an hour ago   Exited (143) About an hour ago                       friendly_mendeleev
[root@vm1 ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                           PORTS               NAMES
83c7ba0b22f3        alpine              "/bin/sh"           49 seconds ago       Exited (130) 19 seconds ago                          blissful_solomon
73f0505a2385        alpine              "/bin/sh"           About a minute ago   Exited (0) 54 seconds ago                            objective_lamport
07e7ccff4a65        49beaba1c5cc        "catalina.sh run"   57 minutes ago       Exited (143) 55 minutes ago                          romantic_nash
4ff207e0bed0        49beaba1c5cc        "catalina.sh run"   About an hour ago    Exited (143) About an hour ago                       friendly_mendeleev
```



```sh
[root@vm1 ~]# docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              3556258649b2        13 days ago         64.2MB
busybox             latest              db8ee88ad75f        2 weeks ago         1.22MB
alpine              latest              b7b28af77ffe        3 weeks ago         5.58MB

# --no-trunc :  이미지 id를 자르지 않고 다 조회
[root@vm1 ~]# docker image ls --no-trunc
REPOSITORY          TAG                 IMAGE ID                                                                  CREATED             SIZE
ubuntu              latest              sha256:3556258649b2ef23a41812be17377d32f568ed9f45150a26466d2ea26d926c32   13 days ago         64.2MB
busybox             latest              sha256:db8ee88ad75f6bdc74663f4992a185e2722fa29573abcc1a19186cc5ec09dceb   2 weeks ago         1.22MB
alpine              latest              sha256:b7b28af77ffec6054d13378df4fdf02725830086c7444d9c278af25312aa39b9   3 weeks ago         5.58MB
```


### docker system
```sh
[root@vm1 ~]# docker system df
TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              3                   1                   70.99MB             65.41MB (92%)
Containers          4                   0                   23.84kB             23.84kB (100%)
Local Volumes       0                   0                   0B                  0B
Build Cache         0                   0                   0B                  0B
[root@vm1 ~]# du -sh /var/lib/docker
780M    /var/lib/docker
```


```sh
[root@vm3 ~]# docker container run -d -p 80:80 httpd
Unable to find image 'httpd:latest' locally
latest: Pulling from library/httpd
f5d23c7fed46: Pull complete
b083c5fd185b: Pull complete
bf5100a89e78: Pull complete
98f47fcaa52f: Pull complete
622a9dd8cfed: Pull complete
Digest: sha256:dc4c86bc90593c6e4c5b06872a7a363fc7d4eec99c5d6bfac881f7371adcb2c4
Status: Downloaded newer image for httpd:latest
91c39ed5cce6aa080dc1444e273dbe95861cf354a43bcd477079f02e372b4f78
[root@vm3 ~]# docker container ls
CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
91c39ed5cce6        httpd               "httpd-foreground"   12 seconds ago      Up 12 seconds       0.0.0.0:80->80/tcp   funny_feynman
[root@vm3 ~]# curl http://laockhost
curl: (6) Could not resolve host: laockhost; Unknown error
[root@vm3 ~]# curl http://localhost
<html><body><h1>It works!</h1></body></html>
```


```sh
# 'con100' 닉네임을 가지고 도커 실행 
[root@vm2 ~]# docker run -it --name con100 alpine


# 프로세스를 종료하지 않고 나오는 방법
ctrl + P , ctrl + q

[root@vm2 ~]# docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES
434e5771efc8        alpine              "/bin/sh"           About a minute ago   Up About a minute                       con100

# 도커 네임 변경
[root@vm2 ~]# docker container rename con100 aaaa
[root@vm2 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES
434e5771efc8        alpine              "/bin/sh"           About a minute ago   Up About a minute                       aaaa

# 'aaaa' 도커 재실행
[root@vm2 ~]# docker exec -it aaa /bin/sh
Error: No such container: aaa
[root@vm2 ~]# docker exec -it aaaa /bin/sh
/ #
```



## 2장 기본적인 도커 사용하기

```sh
[root@vm2 ~]# docker run -it --name myubunutu ubuntu
root@944683d63273:/# cat /etc/*-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=18.04
DISTRIB_CODENAME=bionic
DISTRIB_DESCRIPTION="Ubuntu 18.04.2 LTS"
NAME="Ubuntu"
VERSION="18.04.2 LTS (Bionic Beaver)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 18.04.2 LTS"
VERSION_ID="18.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
root@944683d63273:/# ping 8.8.8.8
bash: ping: command not found
root@944683d63273:/# apt update
Get:1 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]
Get:2 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Get:3 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [5436 B]
Get:4 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [597 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:7 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [4172 B]
Get:8 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [730 kB]
Get:9 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]
Get:10 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]
Get:11 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]
Get:12 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1344 kB]
Get:13 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [10.8 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [1255 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [905 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [14.2 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [2496 B]
Get:18 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [3930 B]
Fetched 16.9 MB in 1min 12s (234 kB/s)
Reading package lists... Done
Building dependency tree
Reading state information... Done
1 package can be upgraded. Run 'apt list --upgradable' to see it.


# ubuntu 에서 ping 설치
root@944683d63273:/# apt install iputils-ping
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  libcap2 libcap2-bin libidn11 libpam-cap
The following NEW packages will be installed:
  iputils-ping libcap2 libcap2-bin libidn11 libpam-cap
0 upgraded, 5 newly installed, 0 to remove and 1 not upgraded.
Need to get 142 kB of archives.
After this operation, 537 kB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://archive.ubuntu.com/ubuntu bionic/main amd64 libcap2 amd64 1:2.25-1.2 [13.0 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libidn11 amd64 1.33-2.1ubuntu1.2 [46.6 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 iputils-ping amd64 3:20161105-1ubuntu3 [54.2 kB]
Get:4 http://archive.ubuntu.com/ubuntu bionic/main amd64 libcap2-bin amd64 1:2.25-1.2 [20.6 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic/main amd64 libpam-cap amd64 1:2.25-1.2 [7268 B]
Fetched 142 kB in 2s (79.6 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libcap2:amd64.
(Reading database ... 4040 files and directories currently installed.)
Preparing to unpack .../libcap2_1%3a2.25-1.2_amd64.deb ...
Unpacking libcap2:amd64 (1:2.25-1.2) ...
Selecting previously unselected package libidn11:amd64.
Preparing to unpack .../libidn11_1.33-2.1ubuntu1.2_amd64.deb ...
Unpacking libidn11:amd64 (1.33-2.1ubuntu1.2) ...
Selecting previously unselected package iputils-ping.
Preparing to unpack .../iputils-ping_3%3a20161105-1ubuntu3_amd64.deb ...
Unpacking iputils-ping (3:20161105-1ubuntu3) ...
Selecting previously unselected package libcap2-bin.
Preparing to unpack .../libcap2-bin_1%3a2.25-1.2_amd64.deb ...
Unpacking libcap2-bin (1:2.25-1.2) ...
Selecting previously unselected package libpam-cap:amd64.
Preparing to unpack .../libpam-cap_1%3a2.25-1.2_amd64.deb ...
Unpacking libpam-cap:amd64 (1:2.25-1.2) ...
Setting up libcap2:amd64 (1:2.25-1.2) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
Setting up libidn11:amd64 (1.33-2.1ubuntu1.2) ...
Setting up iputils-ping (3:20161105-1ubuntu3) ...
Setting up libpam-cap:amd64 (1:2.25-1.2) ...
debconf: unable to initialize frontend: Dialog
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26 /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)
debconf: falling back to frontend: Teletype
Setting up libcap2-bin (1:2.25-1.2) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
root@944683d63273:/# ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=52 time=31.4 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=52 time=30.0 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=52 time=30.0 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 30.008/30.511/31.499/0.712 ms
root@944683d63273:/# uname -r
3.10.0-957.el7.x86_64
```




### docker centos

```sh
# docker pull 
# 최신 이미지를 받는다
docker pull centos
docker pull centos:latest

# docker pull 이미지명:버전
docker pull centos:7.1

# -d 옵션 : 백그라운드에서 실행
[root@vm2 ~]# docker run -itd --name mycentos centos
ef1ee387a1a5247f449005fb0a9cd476fe94b34dd8f9723adc1174fa7e5694d8

[root@vm2 ~]# docker exec -it mycentos /bin/bash
[root@ef1ee387a1a5 /]#

# tree install
[root@ef1ee387a1a5 /]# yum install tree -y
Loaded plugins: fastestmirror, ovl
Loading mirror speeds from cached hostfile
 * base: data.aonenetworks.kr
 * extras: mirror.kakao.com
 * updates: data.aonenetworks.kr
Package tree-1.6.0-10.el7.x86_64 already installed and latest version
Nothing to do

[root@ef1ee387a1a5 /]# clear
[root@ef1ee387a1a5 /]# mkdir /lab
[root@ef1ee387a1a5 /]# touch /lab/secret.file
[root@ef1ee387a1a5 /]# history
    1  ping 8.8.8.8
    2  clera
    3  clear
    4  yum install tree -y
    5  yum install tree -y
    6  clear
    7  mkdir /lab
    8  touch /lab/secret.file
    9  history
[root@ef1ee387a1a5 /]# tree -L 2 /lab
/lab
`-- secret.file

0 directories, 1 file
[root@ef1ee387a1a5 /]# exit
exit
```
```sh
# -d 옵션을 실행한 경우 exit 로 나오더라도 컨테이너가 죽지 않는다
[root@vm2 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
ef1ee387a1a5        centos              "/bin/bash"         5 minutes ago       Up 5 minutes                            mycentos
[root@vm2 ~]# docker stop mycentos
mycentos
[root@vm2 ~]# docker container ls -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
ef1ee387a1a5        centos              "/bin/bash"         6 minutes ago       Exited (137) 7 seconds ago                       mycentos

# docker commit [중지된 컨테이너명] [새로운 컨테이너명]
# 도커 이미지 저장
[root@vm2 ~]# docker commit mycentos ysleeimg
sha256:7326f31e4370dc3a94258a282ae9a6967acc86ab56525dd82c74fdee6bf314aa
[root@vm2 ~]# docker rm $(docker ps -aq) -f
ef1ee387a1a5
[root@vm2 ~]# docker run -it ysleeimg
[root@28b7a4142dc1 /]# ls -l /lab
total 0
-rw-r--r-- 1 root root 0 Aug  6 12:37 secret.file
[root@28b7a4142dc1 /]# tree -L 2 /etc
/etc
|-- BUILDTIME
|-- DIR_COLORS
|-- DIR_COLORS.256color
|-- DIR_COLORS.lightbgcolor
|-- GREP_COLORS
|-- X11
|   |-- applnk
|   |-- fontpath.d
|   `-- xorg.conf.d
|-- adjtime.rpmsave
|-- aliases
|-- alternatives
|   |-- ld -> /usr/bin/ld.bfd
|   `-- libnssckbi.so.x86_64 -> /usr/lib64/pkcs11/p11-kit-trust.so
|-- bash_completion.d
```


### docker run

```sh
# docker centos 이미지에서 ping 명령 실행 (2번 호출)
[root@vm2 ~]# docker run centos ping www.google.com -c 2
PING www.google.com (172.217.161.36) 56(84) bytes of data.
64 bytes from nrt12s23-in-f4.1e100.net (172.217.161.36): icmp_seq=1 ttl=52 time=30.8 ms
64 bytes from nrt12s23-in-f4.1e100.net (172.217.161.36): icmp_seq=2 ttl=52 time=31.0 ms

--- www.google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 30.869/30.963/31.058/0.199 ms

[root@vm2 ~]# docker run centos cat /etc/hostname
a110301454f1
[root@vm2 ~]# docker run centos cat /etc/hosts
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.2      3abb8e54c0a9
[root@vm2 ~]# docker run centos touch /myfile.txt

# 위 명령 실행하자마자 컨테이너 종료
[root@vm2 ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS               NAMES
fe03d8dad3ed        centos              "touch /myfile.txt"      9 seconds ago       Exited (0) 9 seconds ago                          quirky_archimedes
3abb8e54c0a9        centos              "cat /etc/hosts"         20 seconds ago      Exited (0) 19 seconds ago                         eloquent_agnesi
a110301454f1        centos              "cat /etc/hostname"      25 seconds ago      Exited (0) 24 seconds ago                         dazzling_feynman
86548e4661db        centos              "ping www.google.com…"   45 seconds ago      Exited (0) 43 seconds ago                         jovial_williams
28b7a4142dc1        ysleeimg            "/bin/bash"              13 minutes ago      Exited (127) 53 seconds ago                       magical_euclid
[root@vm2 ~]# docker rm $(docker ps -aq) -f
fe03d8dad3ed
3abb8e54c0a9
a110301454f1
86548e4661db
28b7a4142dc1


# -it 옵션 여부에 상관없이, 명령 실행하자 마자 종료
[root@vm2 ~]# docker run --name c1 centos touch /myfile.txt
[root@vm2 ~]# docker ps | grep c1
[root@vm2 ~]# docker ps -a | grep c1
5d31f5f8b3e8        centos              "touch /myfile.txt"   15 seconds ago      Exited (0) 14 seconds ago                       c1
[root@vm2 ~]# docker start c1
c1
[root@vm2 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

[root@vm2 ~]# docker run --name c2 -it centos touch /myfile.txt
[root@vm2 ~]# docker start c2
c2
[root@vm2 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
[root@vm2 ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND               CREATED              STATUS                          PORTS               NAMES
b8c6e5583120        centos              "touch /myfile.txt"   17 seconds ago       Exited (0) 10 seconds ago                           c2
5d31f5f8b3e8        centos              "touch /myfile.txt"   About a minute ago   Exited (0) About a minute ago                       c1
```


## 수강
* Docker IT 인프라구축
  - kt ds univercity
  - 2019년 08월 05일 ~ 2019년 08월 05일 



